<!DOCTYPE html><html lang="zh-cn"><head><meta charset="utf-8"><title>JVM基本结构 | 王欣的博客</title><meta http-equiv="X-UA-Compatible" content="IE=Edge,chrome=1"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no"><meta name="format-detection" content="telephone=no"><meta name="author" content="[object Object]"><meta name="designer" content="minfive"><meta name="keywords" content="开源项目提交者,dubbo,rpc,apache,架构师,信息安全"><meta name="description" content="王欣，Apache Dubbo项目committer、PMC。专注于rpc、云原生、性能优化、信息安全相关的技术，拥抱开源。github：https://github.com/lovepoem email：xin.victorwang@gmail.com"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="black"><meta name="format-detection" content="telephone=yes"><meta name="mobile-web-app-capable" content="yes"><meta name="robots" content="all"><link rel="canonical" href="https://wangxin.io/2018/10/08/jvm/jvm_basic_structure/index.html"><link rel="icon" type="image/png" href="/images/wangxin-min.png" sizes="32x32"><link rel="stylesheet" href="/scss/base/index.css"><link rel="alternate" href="/atom.xml" title="王欣的博客"><script>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?8dd700474b9448fa0d7db1f5e2236886";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-1SDLZ60RR6"></script><script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-1SDLZ60RR6")</script><link rel="stylesheet" href="/scss/views/page/post.css"></head><body ontouchstart><div id="page-loading" class="page page-loading" style="background-image:url(/images/loading.gif)"></div><div id="page" class="page js-hidden"><header class="page__small-header page__header--small"><nav class="page__navbar"><div class="page__container navbar-container"><a class="page__logo" href="/" title="王欣的博客" alt="王欣的博客"><img src="/images/wangxin.png" alt="王欣的博客"></a><nav class="page__nav"><ul class="nav__list clearfix"><li class="nav__item"><a href="/" alt="首页" title="首页">首页</a></li><li class="nav__item"><a href="/archives" alt="归档" title="归档">归档</a></li><li class="nav__item"><a href="/tags" alt="标签" title="标签">标签</a></li><li class="nav__item"><a href="/about" alt="关于" title="关于">关于</a></li><li class="nav__item"><a href="/linkedfriend" alt="menu.linkedfriend" title="menu.linkedfriend">menu.linkedfriend</a></li><li class="nav__item"><a href="https://github.com/lovepoem" alt="menu.github" title="menu.github">menu.github</a></li></ul></nav><button class="page__menu-btn" type="button"><i class="iconfont icon-menu"></i></button></div></nav></header><main class="page__container page__main"><div class="page__content"><article class="page__post"><div class="post__cover"><img src="/images/java.png" alt="JVM基本结构"></div><header class="post__info"><h1 class="post__title">JVM基本结构</h1><div class="post__mark"><div class="mark__block"><i class="mark__icon iconfont icon-write"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="https://wangxin.io">王欣</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-time"></i><ul class="mark__list clearfix"><li class="mark__item"><span>2018-10-08</span></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-tab"></i><ul class="mark__list clearfix"><li class="mark__item"><a href="/tags/jvm/">Jvm</a></li></ul></div><div class="mark__block"><i class="mark__icon iconfont icon-eye"></i><ul class="mark__list clearfix"><li id="busuanzi_container_page_pv" class="mark__item"><span id="busuanzi_value_page_pv"></span>次</li></ul></div></div></header><div class="post__content"><h3><span id="一-什么是-java-gc-垃圾回收">一、什么是 Java GC (垃圾回收) ?</span></h3><p>​ 我们知道，java语言不像C++，将内存的分配和回收给程序员来处理。java用统一的垃圾回收机制来管理java进程的内存，就是通常所说的垃圾回收：<strong>GC（Garbage Collection）</strong>。<br>先到维基百科上看一下<a href="https://en.wikipedia.org/wiki/Garbage_collection_(computer_science)">Garbage Collection</a>的概念:<br>​ In computer science, <strong>garbage collection</strong> (<strong>GC</strong>) is a form of automatic <a href="https://en.wikipedia.org/wiki/Memory_management">memory management</a>. The <em>garbage collector</em>, or just <em>collector</em>, attempts to reclaim <em>garbage</em>, or memory occupied by objectst that are no longer in use by the program. Garbage collection was invented by <a href="https://en.wikipedia.org/wiki/John_McCarthy_(computer_scientist)">John McCarthy</a> around 1959 to simplify manual memory management in Lisp.<br>​ 这就面临一些问题：java进程到底是什么样的结构？java进程的内存哪些需要被回收，在什么条件下才回收，谁来回收？我们首先来看一些概念</p><h3><span id="二-什么是jvm">二、什么是JVM ?</span></h3><p>从维基百科上看<a href="https://en.wikipedia.org/wiki/Java_virtual_machine">jvm的定义</a>:<br>A Java virtual machine (JVM) is a virtual machine that enables a computer to run Java programs as well as programs written in other languages that are also compiled to Java bytecode.</p><h3><span id="三-jvm运行时数据区">三、Jvm运行时数据区</span></h3><p>在Java语言中，采用的是共享内存模型来实现多线程之间的信息交换和数据同步的。 根据<a href="https://docs.oracle.com/javase/specs/index.html">《Java虚拟机文档》</a> 第七版的规定，Java虚拟机锁管理的内存包含下面几个运行时数据区域：<br><img src="/images/jvmcons.png"><br><strong>方法区、虚拟机栈、本地方法栈、队、程序计数器</strong>等。</p><ul><li><p>程序计数器：</p><p>一块较小的内存空间，可以看做是当前线程所执行的<strong>字节码的行数指示器</strong>。</p></li><li><p>JAVA虚拟机栈：</p><p><strong>虚拟机栈</strong>描述的是Java方法执行的内存模型：每个方法在执行的同时会创建一个栈帧（Stack Frame）用于存储<strong>局部变量表、操作数栈、动态链接、方法出口</strong>等信息。</p><p><strong>局部变量表</strong>存放了编译器可知的：</p><ul><li><strong>基本数据类型</strong>（boolean、byte、char、short、int、float、long、double）</li><li><strong>对象引用</strong>：reference类型，可能是一个指向对象起始地址的引用指针，也可能是一个指向对象起始地址的引用指针</li><li><strong>returnAddress地址</strong>：指向了一条字节码指令的地址</li></ul></li><li><p>本地方法栈：</p><p>为虚拟机使用到的Native方法服务，与虚拟机栈的作用类似。</p></li><li><p>JAVA堆：</p><p>Java堆是被所有线程共享的一块内存区域，此内存区域的唯一目的就是存放内存实例，所有的对象实例以及数组都要在堆上分配，是垃圾收集管理的主要区域。</p></li><li><p>方法区：<br>和Java堆一样，是各个线程共享的内存区域，用于存储已被虚拟机加载的<strong>类信息、常量、静态变量、即时编辑器编译后的代码</strong>等</p></li><li><p>运行时常量池</p><p>是方法区的一部分。Class文件中除了有类的版本、字段、方法、接口等描述信息外，还有常量池来存放编译期生成的各种字面量和符号引用。</p></li><li><p>直接内存</p><p>对外内存，不是jvm的存储，所以不受jvm的堆参数控制。NIO可以直接分配对外内存，可能会导致OutOfMemoryError，导致java进程僵死。</p></li></ul><h3><span id="四-对象的访问定位">四、对象的访问定位</span></h3><p>​ 我们Java程序需要通过<strong>栈上</strong>的reference数据来操作<strong>堆上</strong>的具体对象。 有两种方式：<strong>使用句柄访问</strong>和<strong>通过指针访问</strong>。</p><ul><li><p>使用句柄</p><p>Java堆中将会划分出一块内存来作为句柄池，reference中存储的就是对象的句柄地址，句柄中包含了对象实例与类型数据各自的具体地址信息。</p><img src="/images/jvmhandler.png"></li><li><p>通过指针</p><p>Java堆对象的布局中就必须考虑如何放置访问类型数据的相关信息，而reference中存储的直接就是对象地址。</p><img src="/images/jvmdirect.png"></li></ul><p><strong>参考：</strong></p><ul><li>《深入理解java虚拟机》周志明</li><li>图片来自网络</li></ul><div class="post-announce">感谢您的阅读，本文由 <a href="https://wangxin.io">王欣的博客</a> 版权所有。如若转载，请注明出处：王欣的博客（<a href="https://wangxin.io/2018/10/08/jvm/jvm_basic_structure/">https://wangxin.io/2018/10/08/jvm/jvm_basic_structure/</a>）</div><div class="post__prevs"><div class="post__prev"><a href="/2018/10/05/concurrent/analysis_of_thread_pool_error_usage/" title="血的教训：线程池定义一定要全局化，共享使用"><i class="iconfont icon-prev"></i>血的教训：线程池定义一定要全局化，共享使用</a></div><div class="post__prev post__prev--right"><a href="/2018/10/31/java/collection/hashmap_and_concurrenthashmap/" title="并发 - 谈谈HashMap和ConcurrentHashMap">并发 - 谈谈HashMap和ConcurrentHashMap<i class="iconfont icon-next"></i></a></div></div></div></article><div id="comment-container"></div></div><aside class="page__sidebar"><form id="page-search-from" class="page__search-from" action="/search/"><label class="search-form__item"><input class="input" type="text" name="search" placeholder="Search..."> <i class="iconfont icon-search"></i></label></form><div class="sidebar__block"><h3 class="block__title">简介</h3><p class="block__text">王欣，Apache Dubbo项目committer、PMC。专注于rpc、云原生、性能优化、信息安全相关的技术，拥抱开源。github：https://github.com/lovepoem email：xin.victorwang@gmail.com</p></div><div class="sidebar__block"><h3 class="block__title">文章分类</h3><ul class="block-list"><li class="block-list-item"><a class="block-list-link" href="/categories/%E6%88%91%E7%9C%8B/">我看</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/%E5%B7%A5%E4%BD%9C%E6%B5%81/">工作流</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/%E5%AD%98%E5%82%A8/">存储</a><span class="block-list-count">1</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/%E5%AD%98%E5%82%A8/redis/">redis</a><span class="block-list-count">1</span></li></ul></li><li class="block-list-item"><a class="block-list-link" href="/categories/%E5%A4%9A%E7%BA%BF%E7%A8%8B/">多线程</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/spring/">spring</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/shell/">shell</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/mybatis/">mybatis</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/mq/">mq</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/jvm/">jvm</a><span class="block-list-count">2</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/java/">java</a><span class="block-list-count">3</span><ul class="block-list-child"><li class="block-list-item"><a class="block-list-link" href="/categories/java/lambda%E8%A1%A8%E8%BE%BE%E5%BC%8F/">lambda表达式</a><span class="block-list-count">3</span></li></ul></li><li class="block-list-item"><a class="block-list-link" href="/categories/hide/">hide</a><span class="block-list-count">7</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/github/">github</a><span class="block-list-count">1</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/dubbo/">dubbo</a><span class="block-list-count">4</span></li><li class="block-list-item"><a class="block-list-link" href="/categories/apache%E6%B5%81%E7%A8%8B/">apache流程</a><span class="block-list-count">2</span></li></ul></div><div class="sidebar__block"><h3 class="block__title">最新文章</h3><ul class="block-list latest-post-list"><li class="latest-post-item"><a href="/2019/12/08/mq/rocketmq-dead-message/" title="RocketMQ的死信队列你了解多少？怎么实现的？"><div class="item__cover"><img src="/images/java.png" alt="RocketMQ的死信队列你了解多少？怎么实现的？"></div><div class="item__info"><h3 class="item__title">RocketMQ的死信队列你了解多少？怎么实现的？</h3><span class="item__text">2019-12-08</span></div></a></li><li class="latest-post-item"><a href="/2019/12/03/dubbo/dubbo-service-connection-count-control/" title="Dubbo服务间的连接是怎么控制处理的？"><div class="item__cover"><img src="/images/dubbo.png" alt="Dubbo服务间的连接是怎么控制处理的？"></div><div class="item__info"><h3 class="item__title">Dubbo服务间的连接是怎么控制处理的？</h3><span class="item__text">2019-12-03</span></div></a></li><li class="latest-post-item"><a href="/2019/10/31/distributed/distributed_transaction_seata/" title="分布式事务一致性算法Paxos、raft、zab等的比较"><div class="item__cover"><img src="/images/java.png" alt="分布式事务一致性算法Paxos、raft、zab等的比较"></div><div class="item__info"><h3 class="item__title">分布式事务一致性算法Paxos、raft、zab等的比较</h3><span class="item__text">2019-10-31</span></div></a></li><li class="latest-post-item"><a href="/2019/10/31/distributed/distributed_system_consistency_algorithm_paxos_raft_zab/" title="Seata 基本原理和源码分析"><div class="item__cover"><img src="/images/java.png" alt="Seata 基本原理和源码分析"></div><div class="item__info"><h3 class="item__title">Seata 基本原理和源码分析</h3><span class="item__text">2019-10-31</span></div></a></li></ul></div><div class="sidebar__block"><h3 class="block__title">文章标签</h3><ul class="block-list tag-list clearfix"><li class="tag-item"><a class="tag-link" href="/tags/apache%E6%B5%81%E7%A8%8B/">apache流程</a></li><li class="tag-item"><a class="tag-link" href="/tags/dubbo/">dubbo</a></li><li class="tag-item"><a class="tag-link" href="/tags/github/">github</a></li><li class="tag-item"><a class="tag-link" href="/tags/hide/">hide</a></li><li class="tag-item"><a class="tag-link" href="/tags/java8/">java8</a></li><li class="tag-item"><a class="tag-link" href="/tags/jvm/">jvm</a></li><li class="tag-item"><a class="tag-link" href="/tags/lambda/">lambda</a></li><li class="tag-item"><a class="tag-link" href="/tags/mq/">mq</a></li><li class="tag-item"><a class="tag-link" href="/tags/mybatis/">mybatis</a></li><li class="tag-item"><a class="tag-link" href="/tags/redis/">redis</a></li><li class="tag-item"><a class="tag-link" href="/tags/spring5/">spring5</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E5%A4%9A%E7%BA%BF%E7%A8%8B/">多线程</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E5%B7%A5%E4%BD%9C%E6%B5%81/">工作流</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E5%B9%B6%E8%A1%8C/">并行</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E5%BC%82%E6%AD%A5/">异步</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E6%88%91%E7%9C%8B/">我看</a></li><li class="tag-item"><a class="tag-link" href="/tags/%E7%BB%9F%E8%AE%A1/">统计</a></li></ul></div></aside></main><footer class="page__footer"><section class="footer__top"><div class="page__container footer__container"><div class="footer-top__item footer-top__item--2"><h3 class="item__title">关于</h3><div class="item__content"><p class="item__text">王欣的博客，工作生活的一些思考。</p><ul class="footer__contact-info"><li class="contact-info__item"><i class="iconfont icon-address"></i> <span>Beijing, China</span></li><li class="contact-info__item"><i class="iconfont icon-email2"></i> <span>xin.victorwang@gmail.com</span></li></ul></div></div><div class="footer-top__item footer__image"><img src="/images/me.png" alt="logo" title="王欣的博客"></div><div class="footer-top__item"><h3 class="item__title">友情链接</h3><div class="item__content"><ul class="footer-top__list"><li class="list-item"><a href="http://blog.didispace.com/" title="程序猿DD" target="_blank">程序猿DD</a></li><li class="list-item"><a href="http://www.iocoder.cn" title="纯源码解析博客" target="_blank">芋道源码</a></li><li class="list-item"><a href="http://www.ityouknow.com" title="纯洁的微笑" target="_blank">纯洁的微笑</a></li><li class="list-item"><a href="http://blog.720ui.com/" title="梁桂钊的博客" target="_blank">梁桂钊的博客</a></li><li class="list-item"><a href="https://fookwood.com" title="闷瓜蛋子的BLOG" target="_blank">闷瓜蛋子的BLOG</a></li><li class="list-item"><a href="http://www.itmuch.com/" title="周立的博客" target="_blank">周立的博客</a></li></ul></div></div></div></section><section class="footer__bottom"><div class="page__container footer__container"><p class="footer__copyright">© <a href="https://github.com/Mrminfive/hexo-theme-skapp" target="_blank">Skapp</a> 2017 powered by <a href="http://hexo.io/" target="_blank">Hexo</a>, made by <a href="https://github.com/Mrminfive" target="_blank">minfive</a>. <span id="busuanzi_container_site_pv">Total number of visits：<span id="busuanzi_value_site_pv"></span></span>&nbsp;Total visitor number:<span id="busuanzi_value_site_uv"></span></p><ul class="footer__social-network clearfix"><li class="social-network__item"><a href="https://github.com/lovepoem" target="_blank" title="github"><i class="iconfont icon-github"></i></a></li><li class="social-network__item"><a href="mailto:xin.victorwang@gmail.com" target="_blank" title="email"><i class="iconfont icon-email"></i></a></li><li class="social-network__item"><a href="https://weibo.com/wangxinvictor" target="_blank" title="weibo"><i class="iconfont icon-weibo"></i></a></li><li class="social-network__item"><a href="https://twitter.com/wangxinvictor" target="_blank" title="twitter"><i class="iconfont icon-twitter"></i></a></li><li class="social-network__item"><a href="/atom.xml" target="_blank" title="rss"><i class="iconfont icon-rss"></i></a></li></ul></div></section></footer><div id="back-top" class="back-top back-top--hidden js-hidden"><i class="iconfont icon-top"></i></div></div><script src="/js/common.js"></script><script src="/js/page/post.js"></script><link rel="stylesheet" href="https://unpkg.com/gitalk/dist/gitalk.css"><script src="https://unpkg.com/gitalk/dist/gitalk.min.js"></script><script src="/js/md5.min.js"></script><script>var tags=["jvm"],gitalk=new Gitalk({clientID:"dfeb42da2955f5c18a8f",clientSecret:"ec47674c973490128eda38c44beef41d08fe7ce5",repo:"lovepoem.github.io",owner:"lovepoem",admin:["lovepoem"],labels:tags,id:new Date(1538935262e3).getTime()>new Date("2018-02-15").getTime()?md5(location.href):location.href});gitalk.render("comment-container")</script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></body></html>